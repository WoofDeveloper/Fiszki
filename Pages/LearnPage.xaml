<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Fiszki.Models"
             xmlns:pagemodels="clr-namespace:Fiszki.PageModels"
             x:Class="Fiszki.Pages.LearnPage"
             x:DataType="pagemodels:LearnPageModel"
             Title="Nauka">

    <Grid Padding="20">

        <VerticalStackLayout Spacing="20" IsVisible="{Binding IsSessionCompleted, Converter={StaticResource InvertedBoolConverter}}">

            <Label FontSize="16" HorizontalOptions="Center" TextColor="Gray">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="Fiszka "/>
                        <Span Text="{Binding CurrentCardNumber}"/>
                        <Span Text=" z "/>
                        <Span Text="{Binding TotalCards}"/>
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <!-- Karta do odwracania -->
            <Border StrokeShape="RoundRectangle 20" 
                    Stroke="#2196F3" 
                    StrokeThickness="3"
                    BackgroundColor="White"
                    MinimumHeightRequest="350"
                    MaximumHeightRequest="450"
                    Padding="0"
                    VerticalOptions="Center">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.3" Radius="15" Offset="0,5"/>
                </Border.Shadow>

                <Grid>
                    <Grid.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding FlipCardCommand}"/>
                    </Grid.GestureRecognizers>

                    <!-- Przednia strona karty (angielskie słowo) -->
                    <VerticalStackLayout Spacing="20" 
                                        Padding="30"
                                        VerticalOptions="Center"
                                        IsVisible="{Binding IsCardFlipped, Converter={StaticResource InvertedBoolConverter}}">
                        <Label Text="🇬🇧" 
                               FontSize="48" 
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding CurrentFlashcard.EnglishWord}" 
                               FontSize="38" 
                               FontAttributes="Bold" 
                               TextColor="#1976D2" 
                               HorizontalOptions="Center" 
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap"/>
                        <Label Text="{Binding CurrentFlashcard.Example}" 
                               FontSize="15" 
                               FontAttributes="Italic" 
                               TextColor="#757575" 
                               HorizontalOptions="Center" 
                               HorizontalTextAlignment="Center"
                               Margin="0,15,0,0"
                               LineBreakMode="WordWrap"
                               IsVisible="{Binding CurrentFlashcard.Example, Converter={StaticResource IsNotNullConverter}}"/>
                        <Label Text="👆 Kliknij aby zobaczyć tłumaczenie" 
                               FontSize="12" 
                               TextColor="#9E9E9E" 
                               HorizontalOptions="Center"
                               Margin="0,20,0,0"/>
                    </VerticalStackLayout>

                    <!-- Tylna strona karty (polskie tłumaczenie) -->
                    <VerticalStackLayout Spacing="20" 
                                        Padding="30"
                                        VerticalOptions="Center"
                                        BackgroundColor="#E8F5E9"
                                        IsVisible="{Binding IsCardFlipped}">
                        <Label Text="🇵🇱" 
                               FontSize="48" 
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding CurrentFlashcard.PolishTranslation}" 
                               FontSize="38" 
                               FontAttributes="Bold" 
                               TextColor="#2E7D32" 
                               HorizontalOptions="Center" 
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap"/>
                        <Label Text="{Binding CurrentFlashcard.EnglishWord}" 
                               FontSize="18" 
                               TextColor="#757575" 
                               HorizontalOptions="Center"
                               Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Przyciski "Znałem" / "Nie znałem" - pokazują się po odwróceniu karty -->
            <VerticalStackLayout Spacing="15" IsVisible="{Binding IsCardFlipped}">
                <Label Text="Czy znałeś to słowo?" 
                       FontSize="16" 
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="#424242"
                       Margin="0,10,0,0"/>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <Button Grid.Column="0"
                            Text="❌ Nie znałem"
                            Command="{Binding MarkAsIncorrectCommand}"
                            BackgroundColor="#EF5350"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="60"
                            FontSize="16"
                            FontAttributes="Bold"/>

                    <Button Grid.Column="1"
                            Text="✅ Znałem"
                            Command="{Binding MarkAsCorrectCommand}"
                            BackgroundColor="#66BB6A"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="60"
                            FontSize="16"
                            FontAttributes="Bold"/>
                </Grid>
            </VerticalStackLayout>

            <!-- Statystyki sesji -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,20,0,0">
                <Frame Grid.Column="0" BorderColor="Green" CornerRadius="10" Padding="10" BackgroundColor="#E8F5E9">
                    <Label HorizontalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Poprawne " FontSize="14"/>
                                <Span Text="{Binding CorrectCount}" FontSize="20" FontAttributes="Bold" TextColor="Green"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </Frame>
                <Frame Grid.Column="1" BorderColor="Red" CornerRadius="10" Padding="10" BackgroundColor="#FFEBEE">
                    <Label HorizontalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Bledne " FontSize="14"/>
                                <Span Text="{Binding IncorrectCount}" FontSize="20" FontAttributes="Bold" TextColor="Red"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </Frame>
            </Grid>

        </VerticalStackLayout>

        <VerticalStackLayout Spacing="30" VerticalOptions="Center" IsVisible="{Binding IsSessionCompleted}">
            <Label Text="Sesja zakonczona!" FontSize="32" FontAttributes="Bold" HorizontalOptions="Center" TextColor="#4CAF50"/>
            <Frame BorderColor="#4CAF50" CornerRadius="15" Padding="30" BackgroundColor="#E8F5E9">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Twoje wyniki:" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label HorizontalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Poprawne: " FontSize="18"/>
                                <Span Text="{Binding CorrectCount}" FontSize="18" FontAttributes="Bold" TextColor="Green"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Label HorizontalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Bledne: " FontSize="18"/>
                                <Span Text="{Binding IncorrectCount}" FontSize="18" FontAttributes="Bold" TextColor="Red"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>
            </Frame>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Grid.Column="0" Text="Jeszcze raz" Command="{Binding RestartSessionCommand}" BackgroundColor="#FF9800" TextColor="White" CornerRadius="10" HeightRequest="50"/>
                <Button Grid.Column="1" Text="Zakoncz" Command="{Binding FinishSessionCommand}" BackgroundColor="#4CAF50" TextColor="White" CornerRadius="10" HeightRequest="50"/>
            </Grid>
        </VerticalStackLayout>

    </Grid>
</ContentPage>
